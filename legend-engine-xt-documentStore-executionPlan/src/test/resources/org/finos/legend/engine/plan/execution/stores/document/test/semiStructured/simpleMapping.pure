// Copyright 2022 Goldman Sachs
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

###Pure
Class simple::model::Person
{
  firstName: String[1];
  lastName: String[1];
}

###NonRelational
DocumentStore simple::store::MongoDB(
    Collection PERSONS
    (
        firstName String
    )
)

###Pure
function mongo::semiStructured(): String[1]
{
    simple::model::Person.all()->meta::pure::graphFetch::execution::graphFetch(
        #{
            simple::model::Person {
                firstName
            }
        }#
    )->meta::pure::graphFetch::execution::serialize(
        #{
            simple::model::Person {
                firstName
            }
        }#
    )
}

###Mapping
Mapping simple::mapping::document
(
    simple::model::Person: Pure
    {
        ~src simple::model::Person
        firstName: $src.firstName
    }
)

###Connection
DocumentStoreConnection simple::connection::documentStoreConnection
{
    store: simple::store::MongoDB;
    type: 'Mongo';
    specification: MongoDB
    {
        name: 'my_mongo';
        host: 'localhost';
        port: 27017;
    };
    auth: DefaultMongo;
}

###Runtime
Runtime simple::runtime::document
{
    mappings:
    [
        simple::mapping::document
    ];
    connections:
    [
        simple::store::MongoDB:
        [
            connection_1: simple::connection::documentStoreConnection
        ]
    ];
}